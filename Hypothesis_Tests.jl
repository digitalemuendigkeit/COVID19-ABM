using HypothesisTests, Distances
#read final data
final_data = DataFrame!(CSV.File("ExcelCharts\\h5_data.csv",silencewarnings=true))
fear = final_data.Fear
behavior = final_data.Behavior
infected = final_data.Infected
#read, prepare and return real world data
fear_real, behavior_real, infected_real = get_validation_data()
#plot all
fear = fear[1:112]
fear_real = fear_real[1:112]
behavior = behavior[1:112]
behavior_real = behavior_real[1:112]
infected = infected[1:112]
infected_real = infected_real[1:112]
Plots.plot(fear,label="fear_model")
plot!(fear_real,label="fear_real",legend=:bottomright)
plot!(behavior,label="behavior_model")
plot!(behavior_real,label="behavior_real",legend=:bottomright)
Plots.plot(infected,label="infected_model")
plot!(infected_real,label="infected_real",legend=:bottomright)

#MAPEs
error = mape(fear_real,fear)
println("error fear is $error")
error = mape(behavior_real,behavior)
println("error behavior is $error")
error = mape(infected_real,infected)
println("error infected is $error")
#chi square test results
#prepare fear so there is no division by zero and data is rounded to int
fear = Int.(round.(fear))
fear[fear.==0] .= 1
fear = replace(fear, 0 => 1)
fear_real = Int.(round.(fear_real))
fear_real = replace(fear_real, 0 => 1)
#println(ChisqTest(hcat(fear,fear_real)))
#same for behavior_real
behavior_real = Int.(round.(behavior_real))
behavior = Int.(round.(behavior))
behavior = replace(behavior, 0 => 1)
behavior_real = replace(behavior_real, 0 => 1)
#println(ChisqTest(hcat(behavior,behavior_real)))
#and infections
infected = Int.(round.(infected))
infected_real = Int.(round.(infected_real))
#println(ChisqTest(hcat(infected,infected_real)))
#compute RMSE
println("RMSE Fear is $(Distances.nrmsd(fear,fear_real))")
println("RMSE Behavior is $(Distances.nrmsd(behavior,behavior_real))")
println("RMSE Infected is $(Distances.nrmsd(infected,infected_real))")
#compute MAE%
println("MAE% Fear is $(Distances.meanad(fear,fear_real)/mean(fear_real))")
println("MAE% Behavior is $(Distances.meanad(behavior,behavior_real)/mean(behavior_real))")
println("MAE% Infected is $(Distances.meanad(infected,infected_real)/mean(infected_real))")
#compute r2
println("CorrCof Fear is $(cor(fear,fear_real)^2)")
println("CorrCof Behavior is $(cor(behavior,behavior_real)^2)")
println("CorrCof Infected is $(cor(infected,infected_real)^2)")
#compute F-Test
println("F-Test Fear is $(VarianceFTest(fear,fear_real))")
println("F-Test Behavior is $(VarianceFTest(behavior,behavior_real))")
println("F-Test Infected is $(VarianceFTest(inf_no_individual,inf_individual))")

inf_no_comm = infected
inf_comm = [0,0.555555556,1.444444444,2.111111111,3.333333333,5.111111111,6,6.888888889,11,17,22.66666667,31.77777778,42.33333333,50.77777778,61.44444444,87.22222222,115.7777778,147.5555556,187.1111111,238.5555556,273.2222222,315.4444444,381.5555556,449.6666667,528.7777778,620.6666667,725.7777778,805.1111111,885,1017.666667,1155.888889,1289.333333,1436.555556,1612,1740,1870.444444,2057.333333,2240.111111,2431.222222,2636.888889,2845.666667,2996.444444,3147.222222,3357.777778,3584.222222,3808.777778,4032.111111,4243.444444,4373.666667,4505.777778,4716.111111,4973.555556,5232,5457.555556,5645.888889,5750.666667,5856.333333,6085.888889,6360.555556,6624.111111,6841.222222,7000.444444,7094.444444,7192.444444,7418.888889,7691.666667,7956.555556,8166,8323.888889,8408.444444,8508.444444,8887.333333,9308.888889,9671.111111,9926.444444,10112,10194.66667,10276.22222,10514.66667,10833.44444,11093.66667,11283.66667,11426.33333,11492.44444,11559.66667,11742.33333,11916.77778,12058.11111,12188.77778,12299.55556,12357.33333,12412,12531.22222,12627.55556,12712.22222,12791.22222,12875,12916.77778,12963.33333,13040.22222,13108.33333,13172.88889,13249.77778,13333.55556,13373.77778,13410.88889,13493.77778,13557.77778,13613.44444,13677.88889,13735.77778,13789.5]
Plots.plot(inf_no_comm,label="infected_no_messages",legend=:bottomright)
plot!(inf_comm,label="infected_messages",legend=:bottomright)
plot!(infected_real,label="infected_real",legend=:bottomright)

inf_old_model = [0,2,8,10,13,20,24,31,47,60,79,94,120,140,160,206,256,311,360,437,496,554,630,706,780,871,950,1022,1099,1206,1313,1430,1541,1684,1794,1905,2056,2224,2400,2555,2729,2889,3024,3238,3485,3713,3925,4195,4362,4548,4871,5175,5479,5766,6071,6305,6505,6853,7178,7488,7818,8157,8370,8530,8796,9077,9330,9554,9789,9926,10082,10439,10727,10962,11175,11385,11470,11571,11742,11897,12019,12159,12276,12346,12394,12497,12600,12683,12792,12896,12939,12998,13097,13174,13258,13333,13414,13443,13476,13560,13630,13697,13771,13840,13874,13897,13961,14013,14057,14104,14133,14149
]
inf_new_model = [0,0.555555556,1.444444444,2.111111111,3.333333333,5.111111111,6,6.888888889,11,17,22.66666667,31.77777778,42.33333333,50.77777778,61.44444444,87.22222222,115.7777778,147.5555556,187.1111111,238.5555556,273.2222222,315.4444444,381.5555556,449.6666667,528.7777778,620.6666667,725.7777778,805.1111111,885,1017.666667,1155.888889,1289.333333,1436.555556,1612,1740,1870.444444,2057.333333,2240.111111,2431.222222,2636.888889,2845.666667,2996.444444,3147.222222,3357.777778,3584.222222,3808.777778,4032.111111,4243.444444,4373.666667,4505.777778,4716.111111,4973.555556,5232,5457.555556,5645.888889,5750.666667,5856.333333,6085.888889,6360.555556,6624.111111,6841.222222,7000.444444,7094.444444,7192.444444,7418.888889,7691.666667,7956.555556,8166,8323.888889,8408.444444,8508.444444,8887.333333,9308.888889,9671.111111,9926.444444,10112,10194.66667,10276.22222,10514.66667,10833.44444,11093.66667,11283.66667,11426.33333,11492.44444,11559.66667,11742.33333,11916.77778,12058.11111,12188.77778,12299.55556,12357.33333,12412,12531.22222,12627.55556,12712.22222,12791.22222,12875,12916.77778,12963.33333,13040.22222,13108.33333,13172.88889,13249.77778,13333.55556,13373.77778,13410.88889,13493.77778,13557.77778,13613.44444,13677.88889,13735.77778,13789.5
]
Plots.plot(inf_old_model,label="infected_old_model",legend=:bottomright)
plot!(inf_new_model,label="infected_new_model",legend=:bottomright)
plot!(infected_real,label="infected_real",legend=:bottomright)

inf_no_individual = [0,2,8,10,13,20,24,31,47,60,79,94,120,140,160,206,256,311,360,437,496,554,630,706,780,871,950,1022,1099,1206,1313,1430,1541,1684,1794,1905,2056,2224,2400,2555,2729,2889,3024,3238,3485,3713,3925,4195,4362,4548,4871,5175,5479,5766,6071,6305,6505,6853,7178,7488,7818,8157,8370,8530,8796,9077,9330,9554,9789,9926,10082,10439,10727,10962,11175,11385,11470,11571,11742,11897,12019,12159,12276,12346,12394,12497,12600,12683,12792,12896,12939,12998,13097,13174,13258,13333,13414,13443,13476,13560,13630,13697,13771,13840,13874,13897,13961,14013,14057,14104,14133,14149
]
inf_individual = inf_new_model
Plots.plot(inf_no_individual,label="infected_no_individual",legend=:bottomright)
plot!(inf_individual,label="infected_individual",legend=:bottomright)
plot!(infected_real,label="infected_real",legend=:bottomright)

behavior = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.25,0.625,0.875,1.375,1.625,2.375,3.375,4.75,6.5,8,10.25,14.125,18.75,22.125,26.5,30.75,31.375,32.375,38.625,42.5,45.375,48.375,52.375,50.25,48.5,53.125,57.625,60.875,61.25,59.875,55.5,51.5,55.625,62,66,64.875,60.625,55.5,51.375,56,63.625,66.25,65.125,60.25,55.125,50.875,56.125,63.5,66,65.75,60.75,55.5,51.5,60.875,66,68,65.125,60.125,55,51.125,59.625,64.75,66.125,64.375,59.375,54.5,50.375,58.375,63.125,64.375,61.5,56.875,52.125,48.5,56.5,60,59.75,56.125,52.25,48.375,45.25,52,52.875,50.375,49.375,48.5,45.125,41.875,45.25,44,41.5,40.625]
error fear is 29.38617848380964,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
fear = [0,0,0,0,0,0,0,0,0,0,0,0.125,0.125,0.25,0.5,0.625,0.625,1,1.375,1.875,2.625,3.375,4.5,5.625,8,10.625,14.375,19.625,26.125,30.75,38.125,49.875,57,63.25,71,76.875,73.625,75.625,90.25,93.375,97.375,101.5,106.625,99.75,97.625,109.25,114.25,117.5,115.5,113.625,104.375,97.75,113.125,121.75,124.5,120.375,112.375,102.75,96.625,115.125,125.75,126.25,122.5,112.375,102.25,94.875,117.375,127.625,127.125,125.375,115.125,105,97.5,126.25,130,130,124.5,114.375,104.375,97.25,126,130,129.75,125.5,115.125,105.375,97.625,126.125,129.75,129,123.5,113.375,103.875,97.625,125.625,126.25,124.25,117,109,100.375,98,120.375,117.125,111.375,111.5,110.625,101.875,94.375,109.5,103.875,99,100]
error infected is 378.5465701902663,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
infected = [0,0,0,0,1,3,3,7,10,14,22,31,50,60,67,110,138,186,237,302,336,388,460,545,617,712,813,901,992,1152,1302,1427,1587,1733,1852,1983,2175,2354,2551,2759,2960,3124,3257,3438,3631,3846,4044,4237,4341,4443,4585,4784,5036,5267,5413,5470,5496,5642,5881,6133,6354,6443,6476,6503,6651,6915,7175,7382,7443,7467,7510,7771,8199,8610,8776,8836,8870,8932,9208,9633,9996,10175,10230,10264,10296,10563,10872,11135,11271,11308,11335,11389,11584,11771,11931,12044,12093,12120,12176,12310,12429,12537,12640,12726,12763,12806,12901,12986,13050,13129,13215,13258]
